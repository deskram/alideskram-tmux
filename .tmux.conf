##### ===== Tmux — Nord Base, Sharp Triangles, Current IP Far Right ===== #####

# --- Truecolor & terminal capabilities ---
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",xterm-256color:RGB"
set -ga terminal-overrides ",*:Tc"

# --- Core / Prefix ---
unbind C-b
set -g prefix C-a
bind C-a send-prefix
set -s escape-time 300
set -g xterm-keys on
set -g focus-events on
set -g assume-paste-time 1

# --- Mouse ---
set -g mouse on
unbind -n MouseDown3Pane

# --- Vim-style Pane Navigation ---
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# --- Pane Resize (small steps) ---
bind -r H resize-pane -L 2
bind -r L resize-pane -R 2
bind -r J resize-pane -D 2
bind -r K resize-pane -U 2

# --- Splits ---
bind | split-window -h
bind - split-window -v

# --- Window Navigation ---
bind , previous-window
bind . next-window

# --- Zoom Toggle ---
bind z resize-pane -Z

# --- Window / Pane Management ---
bind c new-window
bind x kill-pane

# --- Live Reload ---
bind r source-file ~/.tmux.conf \; display-message "Config Reloaded!"

# --- Kill other sessions (keep this one) ---
bind = run-shell "~/.tmux/scripts/kill-other-sessions.sh" \; display-message "Other Sessions Killed"

# --- Copy Mode (Vi) + System Clipboard Integration ---
setw -g mode-keys vi
set -s set-clipboard on

# Auto-pick platform copy command
set -g @copy_command 'printf'
if-shell 'uname -s | grep -qi darwin'  'set -g @copy_command "pbcopy"'
if-shell 'command -v wl-copy >/dev/null 2>&1' 'set -g @copy_command "wl-copy"'
if-shell 'command -v xclip  >/dev/null 2>&1' 'set -g @copy_command "xclip -selection clipboard -in"'
if-shell 'command -v xsel   >/dev/null 2>&1' 'set -g @copy_command "xsel -ib"'
# (Optional WSL)
# if-shell 'grep -qi microsoft /proc/version 2>/dev/null' 'set -g @copy_command "clip.exe"'

# Copy workflow
bind [ copy-mode
bind -T copy-mode-vi v     send -X begin-selection
bind -T copy-mode-vi y     send -X copy-pipe-and-cancel "#{@copy_command}"
bind -T copy-mode-vi Enter send -X copy-pipe-and-cancel "#{@copy_command}"
bind -T copy-mode    q     send -X cancel
bind -T copy-mode    Escape send -X cancel
bind p paste-buffer
bind Y run-shell "tmux save-buffer - | #{@copy_command} ; tmux display-message 'Copied to system clipboard'"

# Optional: mouse drag copy straight to clipboard
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-pipe-and-cancel "#{@copy_command}"

# --- History ---
set -g history-limit 1000

# === Preset Layout Shortcuts ===
bind-key T run-shell "tmux split-window -h -p 50; tmux select-pane -t 0"
bind-key M run-shell "tmux split-window -v -p 50; tmux split-window -h -t 1; tmux select-pane -t 0"
bind-key F run-shell "tmux split-window -h -p 66; tmux split-window -h -p 50; tmux select-layout tiled; tmux split-window -v -p 30 -t 0; tmux select-pane -t 0"
bind-key P run-shell "tmux split-window -h -p 30; tmux select-pane -t 0"
bind-key C run-shell "tmux split-window -v -p 30; tmux select-pane -t 0"

# === Plugins (TPM + persistence) ===
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# --- alideskram: Sharp separators + NORD theme ---
run-shell "~/.tmux/alideskram/deskram.tmux"
set -g @alideskram-theme 'nord'               

# Sharp separators (no rounded glyphs)
set -g @alideskram-left-sep  ''
set -g @alideskram-right-sep ''
set -g @alideskram-window-list-left-sep  ''
set -g @alideskram-window-list-right-sep ''

##### ----- NORD Palette (per request) ----- #####
set -g @alideskram-bg-main  '#2e3440'   # base
set -g @alideskram-bg-alt   '#3b4252'   # alt
set -g @alideskram-bg-seg1  '#434c5e'   # triangle step 1
set -g @alideskram-bg-seg2  '#4c566a'   # triangle step 2
set -g @alideskram-bg-seg3  '#3b4252'   # triangle step 3
set -g @alideskram-text     '#e5e9f0'   # text color

# Accents within Nord range
set -g @alideskram-pane-active-border '#4c566a'
set -g @alideskram-prefix-highlight   '#4c566a'
set -g @alideskram-message-bg         '#3b4252'
set -g @alideskram-message-fg         '#e5e9f0'
set -g @alideskram-pane-border        '#434c5e'

##### --- Map plugins to gradient steps --- #####
# Left side (L→R): session → git → cwd
set -g @alideskram-session-colors 'bg_seg1 text'
set -g @alideskram-git-colors     'bg_seg2 text'
set -g @alideskram-cwd-colors     'bg_seg3 text'

# Right side (L→R): cpu → time → network (IP at far right)
set -g @alideskram-cpu-colors     'bg_seg1 text'
set -g @alideskram-time-colors    'bg_seg2 text'
set -g @alideskram-network-colors 'bg_seg3 text'

# Keep IP at the extreme right (no Battery / RAM)
set -g @alideskram-left-plugins  'session git cwd'
set -g @alideskram-right-plugins 'cpu time network'
set -g @alideskram-network-display 'type+ip' 
set -g @alideskram-refresh-rate '1'
set -g status-right-length 200

# --- Resurrect / Continuum ---
set -g @resurrect-save 'C-s'
set -g @resurrect-restore 'C-r'
set -g @continuum-restore 'on'
set -g @continuum-save-interval '10'
bind-key S run-shell "~/.tmux/plugins/tmux-resurrect/scripts/save.sh; ~/.tmux/scripts/prune-resurrect.sh"

# --- Load TPM (keep last) ---
run '~/.tmux/plugins/tpm/tpm'

##### Cheatsheet (Prefix = Ctrl+a)
# | split-h, - split-v, z zoom, h/j/k/l move, c new, x kill, r reload
# , prev win, . next win, [ copy-mode, v select, y/Enter copy→clipboard, p paste
# = kill other sessions, S save+prune, C-s save, C-r restore

##### Prefix Reminder #####
# Ctrl+a then:
#   | → vertical split
#   - → horizontal split
#   z → zoom
#   , → move to the window on the left
#   . → move to the window on the right
#   h/j/k/l → move between panes
#   x → kill current pane
#   c → new window
#   r → reload config
#   = → kill all sessions except current
#   S → manual save + prune (resurrect)
#   [ → enter copy mode
#   v → select text in copy mode
#   y → copy selected text
#   p → paste copied text
#   q or Esc → exit copy mode
#   Ctrl + c → cancel copy mode

########## End of Configuration ##########
